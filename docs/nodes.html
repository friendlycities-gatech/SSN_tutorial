<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Visualizing Nodes | Spatial Social Networks (SSN) Visualization and Metrics with R</title>
  <meta name="description" content="This book describes the basic concepts, theories, methods, and visualizations involved to map and analyze spatial networks in R." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Visualizing Nodes | Spatial Social Networks (SSN) Visualization and Metrics with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book describes the basic concepts, theories, methods, and visualizations involved to map and analyze spatial networks in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Visualizing Nodes | Spatial Social Networks (SSN) Visualization and Metrics with R" />
  
  <meta name="twitter:description" content="This book describes the basic concepts, theories, methods, and visualizations involved to map and analyze spatial networks in R." />
  

<meta name="author" content="Xiaofan Liang, Clio Andris, Dipto Sarkar" />


<meta name="date" content="2023-05-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="metrics.html"/>
<link rel="next" href="vizedges.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SSN Tutorial</a></li>

<li class="divider"></li>
<li><a href="index.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="metrics.html#metrics" id="toc-metrics"><span class="toc-section-number">2</span> Network Metrics</a>
<ul>
<li><a href="metrics.html#network-data-formats" id="toc-network-data-formats"><span class="toc-section-number">2.1</span> Network Data Formats</a></li>
<li><a href="metrics.html#network-metrics" id="toc-network-metrics"><span class="toc-section-number">2.2</span> Network Metrics</a>
<ul>
<li><a href="metrics.html#network-metrics-for-nodes" id="toc-network-metrics-for-nodes"><span class="toc-section-number">2.2.1</span> Network Metrics for Nodes</a></li>
<li><a href="metrics.html#network-metrics-for-edges" id="toc-network-metrics-for-edges"><span class="toc-section-number">2.2.2</span> Network Metrics for Edges</a></li>
</ul></li>
<li><a href="metrics.html#igraph-visualization" id="toc-igraph-visualization"><span class="toc-section-number">2.3</span> igraph Visualization</a></li>
</ul></li>
<li><a href="nodes.html#nodes" id="toc-nodes"><span class="toc-section-number">3</span> Visualizing Nodes</a>
<ul>
<li><a href="nodes.html#convert-coordinates-to-points" id="toc-convert-coordinates-to-points"><span class="toc-section-number">3.1</span> Convert Coordinates to Points</a></li>
<li><a href="nodes.html#visualize-nodes" id="toc-visualize-nodes"><span class="toc-section-number">3.2</span> Visualize Nodes</a></li>
<li><a href="nodes.html#visualize-nodes-by-node-color" id="toc-visualize-nodes-by-node-color"><span class="toc-section-number">3.3</span> Visualize Nodes by Node Color</a></li>
<li><a href="nodes.html#visualize-nodes-by-node-size" id="toc-visualize-nodes-by-node-size"><span class="toc-section-number">3.4</span> Visualize Nodes by Node Size</a></li>
<li><a href="nodes.html#visualize-nodes-by-size-and-color" id="toc-visualize-nodes-by-size-and-color"><span class="toc-section-number">3.5</span> Visualize Nodes by Size and Color</a></li>
</ul></li>
<li><a href="vizedges.html#vizedges" id="toc-vizedges"><span class="toc-section-number">4</span> Visualizing Edges</a>
<ul>
<li><a href="vizedges.html#convert-points-into-lines" id="toc-convert-points-into-lines"><span class="toc-section-number">4.1</span> Convert Points into Lines</a>
<ul>
<li><a href="vizedges.html#method-1-use-od2line-function-in-stplanr-package." id="toc-method-1-use-od2line-function-in-stplanr-package."><span class="toc-section-number">4.1.1</span> Method 1: Use <code>od2line</code> function in <code>stplanr</code> package.</a></li>
<li><a href="vizedges.html#method-2-group-by-lineid-and-summarize-points-into-line" id="toc-method-2-group-by-lineid-and-summarize-points-into-line"><span class="toc-section-number">4.1.2</span> Method 2: Group by lineID and Summarize Points into Line</a></li>
<li><a href="vizedges.html#method-3-join-two-point-geometry-into-one-row-and-unite-into-line" id="toc-method-3-join-two-point-geometry-into-one-row-and-unite-into-line"><span class="toc-section-number">4.1.3</span> Method 3: Join Two Point Geometry into One Row and Unite into Line</a></li>
</ul></li>
<li><a href="vizedges.html#visualizing-edges" id="toc-visualizing-edges"><span class="toc-section-number">4.2</span> Visualizing Edges</a></li>
<li><a href="vizedges.html#visualizing-edges-by-line-width" id="toc-visualizing-edges-by-line-width"><span class="toc-section-number">4.3</span> Visualizing Edges by Line Width</a></li>
<li><a href="vizedges.html#visualizing-edges-by-color" id="toc-visualizing-edges-by-color"><span class="toc-section-number">4.4</span> Visualizing Edges by Color</a></li>
<li><a href="vizedges.html#visualizing-edges-by-width-and-color" id="toc-visualizing-edges-by-width-and-color"><span class="toc-section-number">4.5</span> Visualizing Edges by Width and Color</a></li>
</ul></li>
<li><a href="advanced-aesthetics.html#advanced-aesthetics" id="toc-advanced-aesthetics"><span class="toc-section-number">5</span> Advanced Aesthetics</a>
<ul>
<li><a href="advanced-aesthetics.html#export-maps" id="toc-export-maps"><span class="toc-section-number">5.1</span> Export Maps</a></li>
<li><a href="advanced-aesthetics.html#small-multiples" id="toc-small-multiples"><span class="toc-section-number">5.2</span> Small Multiples</a></li>
<li><a href="advanced-aesthetics.html#interactive-maps" id="toc-interactive-maps"><span class="toc-section-number">5.3</span> Interactive Maps</a></li>
<li><a href="advanced-aesthetics.html#base-map" id="toc-base-map"><span class="toc-section-number">5.4</span> Base Map</a></li>
<li><a href="advanced-aesthetics.html#inset-map" id="toc-inset-map"><span class="toc-section-number">5.5</span> Inset Map</a></li>
<li><a href="advanced-aesthetics.html#edge-bundling" id="toc-edge-bundling"><span class="toc-section-number">5.6</span> Edge Bundling</a></li>
</ul></li>
<li><a href="advanced-ssn-metrics.html#advanced-ssn-metrics" id="toc-advanced-ssn-metrics"><span class="toc-section-number">6</span> Advanced SSN Metrics</a>
<ul>
<li><a href="advanced-ssn-metrics.html#ssn-hotspots-detection" id="toc-ssn-hotspots-detection"><span class="toc-section-number">6.1</span> SSN Hotspots Detection</a>
<ul>
<li><a href="advanced-ssn-metrics.html#calculate-ssn-hotspots-using-radius-or-k-nearest-neighbor-window-sizes" id="toc-calculate-ssn-hotspots-using-radius-or-k-nearest-neighbor-window-sizes"><span class="toc-section-number">6.1.1</span> Calculate SSN hotspots using radius or K-nearest neighbor window sizes</a></li>
<li><a href="advanced-ssn-metrics.html#visualize-ssn-hotspots" id="toc-visualize-ssn-hotspots"><span class="toc-section-number">6.1.2</span> Visualize SSN hotspots</a></li>
<li><a href="advanced-ssn-metrics.html#find-optimal-window-sizes-for-ssn-hotspots" id="toc-find-optimal-window-sizes-for-ssn-hotspots"><span class="toc-section-number">6.1.3</span> Find optimal window sizes for SSN hotspots</a></li>
<li><a href="advanced-ssn-metrics.html#calculate-ssn-hotspots-using-a-user-defined-walking-distance-matrix-extracted-from-osm" id="toc-calculate-ssn-hotspots-using-a-user-defined-walking-distance-matrix-extracted-from-osm"><span class="toc-section-number">6.1.4</span> Calculate SSN hotspots using a user-defined walking distance matrix extracted from OSM</a></li>
<li><a href="advanced-ssn-metrics.html#application-to-a-weighted-and-bipartite-network" id="toc-application-to-a-weighted-and-bipartite-network"><span class="toc-section-number">6.1.5</span> Application to a weighted and bipartite network</a></li>
</ul></li>
<li><a href="advanced-ssn-metrics.html#k-fullfillment" id="toc-k-fullfillment"><span class="toc-section-number">6.2</span> K-fullfillment</a>
<ul>
<li><a href="advanced-ssn-metrics.html#calculate-k-fullfillment-values" id="toc-calculate-k-fullfillment-values"><span class="toc-section-number">6.2.1</span> Calculate K-fullfillment values</a></li>
<li><a href="advanced-ssn-metrics.html#visualize-k-fullfillment" id="toc-visualize-k-fullfillment"><span class="toc-section-number">6.2.2</span> Visualize K-fullfillment</a></li>
<li><a href="advanced-ssn-metrics.html#application-to-a-bipartite-network" id="toc-application-to-a-bipartite-network"><span class="toc-section-number">6.2.3</span> Application to a bipartite network</a></li>
</ul></li>
<li><a href="advanced-ssn-metrics.html#flattening-ratio" id="toc-flattening-ratio"><span class="toc-section-number">6.3</span> Flattening Ratio</a>
<ul>
<li><a href="advanced-ssn-metrics.html#calculate-local-flattening-ratio" id="toc-calculate-local-flattening-ratio"><span class="toc-section-number">6.3.1</span> Calculate Local Flattening Ratio</a></li>
<li><a href="advanced-ssn-metrics.html#visualize-local-flattening-ratio" id="toc-visualize-local-flattening-ratio"><span class="toc-section-number">6.3.2</span> Visualize Local Flattening Ratio</a></li>
<li><a href="advanced-ssn-metrics.html#application-to-a-bipartite-network-1" id="toc-application-to-a-bipartite-network-1"><span class="toc-section-number">6.3.3</span> Application to a bipartite network</a></li>
</ul></li>
<li><a href="advanced-ssn-metrics.html#linked-activity-spaces" id="toc-linked-activity-spaces"><span class="toc-section-number">6.4</span> Linked Activity Spaces</a>
<ul>
<li><a href="advanced-ssn-metrics.html#visualize-linked-activity-spaces" id="toc-visualize-linked-activity-spaces"><span class="toc-section-number">6.4.1</span> Visualize Linked Activity Spaces</a></li>
<li><a href="advanced-ssn-metrics.html#quantify-linked-activity-spaces" id="toc-quantify-linked-activity-spaces"><span class="toc-section-number">6.4.2</span> Quantify Linked Activity Spaces</a></li>
</ul></li>
</ul></li>
<li><a href="development.html#development" id="toc-development"><span class="toc-section-number">7</span> Future Development</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Social Networks (SSN) Visualization and Metrics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="nodes" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Visualizing Nodes</h1>
<p>In this chapter, we continue to use the American Mafia data introduced in Chapter 2. They can be loaded from the <code>SSNtools</code> package directly.</p>
<p>The node table <strong>MafiaNodes</strong> contains:</p>
<ul>
<li><code>NODE</code>: Name of the Mafia member (capitalized)</li>
<li><code>Family</code>: Mafia family the member belongs to</li>
<li><code>NY</code>: Whether the member is in New York City</li>
<li><code>LonX</code>: Longitude of the location of the member</li>
<li><code>LatY</code>: Latitude of the location of the member</li>
<li><code>NiceLabel</code>: Name of the Mafia member (lower case)</li>
</ul>
<p>The edge list <strong>MafiaEdges</strong> contains pairs of undirected connections:</p>
<ul>
<li><code>Source</code>: the name of a member</li>
<li><code>Target</code>: the name of a different member</li>
</ul>
<p>This chapter covers the following topics:</p>
<ul>
<li>How to convert node coordinates into point geometry</li>
<li>How to visualize nodes with constant color and size</li>
<li>How to visualize nodes with varying node size by attributes</li>
<li>How to visualize nodes with varying color by attributes</li>
<li>How to visualize nodes with varying node size and color with a combined legend</li>
</ul>
<p>You will be able to find a copy of all the codes at the bottom of the page.</p>
<p><img src="Figs/03-nodes-1.png" width="50%" /><img src="Figs/03-nodes-2.png" width="50%" /><img src="Figs/03-nodes-3.png" width="50%" /><img src="Figs/03-nodes-4.png" width="50%" /></p>
<p>Before proceeding to the codes, please load the following packages:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="nodes.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb20-2"><a href="nodes.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb20-3"><a href="nodes.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb20-4"><a href="nodes.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb20-5"><a href="nodes.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb20-6"><a href="nodes.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb20-7"><a href="nodes.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;devtools&quot;) #to download R package on GitHub</span></span>
<span id="cb20-8"><a href="nodes.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github(&quot;friendlycities-gatech/SSNtools&quot;)</span></span>
<span id="cb20-9"><a href="nodes.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SSNtools)</span></code></pre></div>
<div id="convert-coordinates-to-points" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Convert Coordinates to Points</h2>
<p>The data for the nodes may come in two common format. One is the node table that we mentioned in Chapter 2 (REF), and the other is spatial object, in which nodes are already point geometry. The <strong>node table</strong> often stores the spatial information of the node as two columns: <code>latitude</code> and <code>longitude</code>. <strong>Spatial object</strong> contains spatial information of the node in the <code>geometry</code> column. It also includes projection coordinates system of the object. Unless you are working with <code>ggplot2</code>, most other visualization packages require nodes to be spatial objects for mapping.</p>
<p>You can convert a node table with coordinates into a spatial object with <code>st_as_sf</code> function in <code>sf</code> package. Spatial information is stored in the <strong>LonX</strong> and <strong>LatY</strong> column in <code>MafiaNodes</code> node table. Therefore, when we convert it to <code>sf</code> spatial object, we need to set the coordinates crs to be <em>WGS84</em> (4326).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="nodes.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#MafiaNodes is a built-in dataset in SSNtools R package</span></span>
<span id="cb21-2"><a href="nodes.html#cb21-2" aria-hidden="true" tabindex="-1"></a>MafiaSpatial <span class="ot">=</span> MafiaNodes <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="nodes.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">&quot;LonX&quot;</span>, <span class="st">&quot;LatY&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>) </span>
<span id="cb21-4"><a href="nodes.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="nodes.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(MafiaSpatial, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Simple feature collection with 3 features and 4 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -117.291 ymin: 34.1493 xmax: -77.5774 ymax: 43.1356
## Geodetic CRS:  WGS 84
##               NODE      Family NY        NiceLabel                 geometry
## 1 VALENTI-COSTENZA     Bonanno  1 Costenza Valenti POINT (-77.6064 43.1349)
## 2    VALENTI-FRANK     Bonanno  1    Frank Valenti POINT (-77.5774 43.1356)
## 3 DIPOLLITO-JOSEPH Los_Angeles  0 Joseph Dipollito POINT (-117.291 34.1493)</code></pre>
</div>
<div id="visualize-nodes" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Visualize Nodes</h2>
<p><strong>First step</strong>, we download the U.S. state shapefile through <code>tigris</code> package as the background for visualization and transform the shapefile and the dataframe data to the appropriate crs (coordinate reference system).</p>
<p>The coordinate information can be stored in other projection system other than the commonly used WGS84. Users need to find out what crs is used before transforming the data to another system. Only when crs are the same for two or more shapefiles (or geometry) can we overlay them correctly on each other. Since we are mapping the data on U.S. mainland, we exclude U.S. territories and further transform the node table into <code>sf</code> spatial objects with <em>North America Equidistant Conic projection</em> (crs=“ESRI:102010”).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="nodes.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert coordinate system</span></span>
<span id="cb23-2"><a href="nodes.html#cb23-2" aria-hidden="true" tabindex="-1"></a>MafiaSpatial <span class="ot">=</span> MafiaSpatial <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="nodes.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(MafiaSpatioal, <span class="at">crs=</span><span class="st">&quot;ESRI:102010&quot;</span>)</span>
<span id="cb23-4"><a href="nodes.html#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="nodes.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#states is a function in tigris to download U.S. state boundary shapefile</span></span>
<span id="cb23-6"><a href="nodes.html#cb23-6" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">=</span> <span class="fu">states</span>(<span class="at">cb=</span><span class="cn">TRUE</span>, <span class="at">progress_bar =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="nodes.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>STUSPS <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;PR&#39;</span>,<span class="st">&#39;AS&#39;</span>, <span class="st">&#39;AK&#39;</span>, <span class="st">&#39;GU&#39;</span>,<span class="st">&#39;MP&#39;</span>,<span class="st">&#39;VI&#39;</span>, <span class="st">&#39;HI&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="nodes.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="st">&quot;ESRI:102010&quot;</span>)</span></code></pre></div>
<p><strong>Second step</strong>: visualize the nodes on the US state map!</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="nodes.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&#39;plot&#39;</span>) <span class="co"># set tmap plotting mode to static map </span></span>
<span id="cb24-2"><a href="nodes.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(us_states) <span class="sc">+</span>  </span>
<span id="cb24-3"><a href="nodes.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span> <span class="co">#draw U.S. state shapefile first as polygons</span></span>
<span id="cb24-4"><a href="nodes.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(MafiaSpatial) <span class="sc">+</span> </span>
<span id="cb24-5"><a href="nodes.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>() <span class="co">#overlay nodes as points</span></span></code></pre></div>
<p><img src="SSN_tutorial_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="visualize-nodes-by-node-color" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Visualize Nodes by Node Color</h2>
<p>The map above only shows the locations of Mafia members. We want to visualize the influence of these members and find out where influential people reside. We load the edge file <code>MafiaEdges</code> and calculate the degree of each node.</p>
<p><strong>To vary the node color by degree</strong>, we simply set the <code>col</code> argument to the variable <code>degree</code> that should vary by color. Different from node size, <code>style</code> argument can modulate the breaks for node color in different styles, such as quantile breaks, equal interval breaks, head/tail breaks and so on. The number of class is defaulted to five. To define the color, you can either pass a R palette (e.g., <code>YlGnBu</code>) or a vector of color to <code>palette</code> argument. More details can be found in <code>tmap</code> <a href="https://cran.r-project.org/web/packages/tmap/tmap.pdf">document</a>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="nodes.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#MafiaEdges is a built-in dataset in SSNtools</span></span>
<span id="cb25-2"><a href="nodes.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Construct a network and calculate the degree for each node. </span></span>
<span id="cb25-3"><a href="nodes.html#cb25-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">graph_from_data_frame</span>(MafiaEdges, <span class="at">directed =</span> <span class="cn">FALSE</span>, <span class="at">vertices=</span>MafiaSpatial)</span>
<span id="cb25-4"><a href="nodes.html#cb25-4" aria-hidden="true" tabindex="-1"></a>MafiaSpatial<span class="sc">$</span>degree <span class="ot">=</span> <span class="fu">degree</span>(g)</span>
<span id="cb25-5"><a href="nodes.html#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="nodes.html#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&#39;plot&#39;</span>)</span>
<span id="cb25-7"><a href="nodes.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(us_states) <span class="sc">+</span></span>
<span id="cb25-8"><a href="nodes.html#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb25-9"><a href="nodes.html#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(MafiaSpatial) <span class="sc">+</span></span>
<span id="cb25-10"><a href="nodes.html#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>(</span>
<span id="cb25-11"><a href="nodes.html#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span><span class="dv">1</span>, <span class="co">#constant node size</span></span>
<span id="cb25-12"><a href="nodes.html#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="st">&#39;degree&#39;</span>, <span class="at">palette =</span> <span class="st">&#39;YlGnBu&#39;</span>, <span class="co">#define which numeric column to vary by color and the color palette</span></span>
<span id="cb25-13"><a href="nodes.html#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">style=</span><span class="st">&#39;quantile&#39;</span>, <span class="at">n =</span> <span class="dv">4</span>, <span class="co">#define the color breaks using quantile, and set the number of classes to 4.</span></span>
<span id="cb25-14"><a href="nodes.html#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">border.col=</span><span class="st">&#39;black&#39;</span>, <span class="at">border.alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb25-15"><a href="nodes.html#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title.col=</span><span class="fu">c</span>(<span class="st">&#39;Degree of Connections&#39;</span>))</span></code></pre></div>
<p><img src="SSN_tutorial_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="visualize-nodes-by-node-size" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Visualize Nodes by Node Size</h2>
<p><strong>To visualize the node size by the connection degree</strong>, we have to set the node size varies by degree in <code>tm_symbols</code>. The default breaks for node size is interval breaks. You can adjust the breaks for node size in the legend directly through <code>sizes.legend</code> argument in <code>tm_symbols</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="nodes.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize </span></span>
<span id="cb26-2"><a href="nodes.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&#39;plot&#39;</span>)</span>
<span id="cb26-3"><a href="nodes.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(us_states) <span class="sc">+</span></span>
<span id="cb26-4"><a href="nodes.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha=</span><span class="dv">0</span>) <span class="sc">+</span> <span class="co">#turn the background color of the polygons to transparent</span></span>
<span id="cb26-5"><a href="nodes.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(MafiaSpatial) <span class="sc">+</span></span>
<span id="cb26-6"><a href="nodes.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>(<span class="at">size=</span><span class="st">&quot;degree&quot;</span>, <span class="at">scale=</span><span class="dv">2</span>, <span class="co">#scale up the node size </span></span>
<span id="cb26-7"><a href="nodes.html#cb26-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span><span class="st">&#39;lightblue&#39;</span>, <span class="at">border.col=</span><span class="st">&#39;#6698CC&#39;</span>, </span>
<span id="cb26-8"><a href="nodes.html#cb26-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">title.size=</span><span class="fu">c</span>(<span class="st">&#39;Degree of Connections&#39;</span>))</span></code></pre></div>
<p><img src="SSN_tutorial_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<!-- One challenge for this map (and others that visualize nodes) is that there are too many nodes cluster at nearby locations, which makes it difficult for people to find the most influential people and see the distribution of the nodes. One solution is to adjust the breaks of the node size and add color to breaks so that the influential nodes can stand out more. Another solution is to create an inset map for New York City area where the nodes are most cluttered (see Chapter5).  -->
<p><strong>If you want node size to follow a particular break, then nodes need to be grouped into size brackets</strong>. Differnt from color whose breaks can be adjusted in <code>style</code> argument (e.g., style=‘quantile’), changing node size is not straightforward. This example shows how to size nodes in quantile breaks. We first check the quantile breakdown of the degree in the data as the reference. Then, we create a new <code>degree_brackets</code> column that group nodes with different degree to ordered categories. Lastly, we set the <code>size</code> argument in <code>tm_symbols</code> to the new <code>degree_brackets</code> column, which changes the size of the nodes in the map. We adjust the legend breaks using <code>sizes.legend</code>. <code>sizes.legend</code> only changes the size of the nodes in the legend but not for nodes in the map (use scale for the latter). More details can be found in <code>tmap</code> <a href="https://cran.r-project.org/web/packages/tmap/tmap.pdf">document</a>.</p>
<p><strong>The final node size in the map = relative node size defined in <code>degree_brackets</code> / <code>size.max</code> * <code>scale</code></strong></p>
<p>Numbers in the <code>degree_brackets</code> column only define the relative size difference between the nodes. <code>size.max</code> and <code>scale</code> are often defaulted to be 1, therefore makes it easy for people to directly define node size in the <code>degree_brackets</code> column. In that case, the node with designated with the highest size value will have the node size of 1. In our example, node size of 1 is visually too small in the map, so we scale up the node size by 1.5. Thus, the actual node sizes for the four brackets are c(0.1, 0.3, 0.5, 1)/1*1.5 = c(0.15, 0.45, 0.75, 1.5).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="nodes.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(MafiaSpatial<span class="sc">$</span>degree)</span></code></pre></div>
<pre><code>##   0%  25%  50%  75% 100% 
##    1    4    6   10   77</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="nodes.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new &#39;degree_bracket&#39; column that contains the node size for each group of nodes. </span></span>
<span id="cb29-2"><a href="nodes.html#cb29-2" aria-hidden="true" tabindex="-1"></a>MafiaSpatial <span class="ot">=</span> MafiaSpatial <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="nodes.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">degree_brackets =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-4"><a href="nodes.html#cb29-4" aria-hidden="true" tabindex="-1"></a>    degree <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> degree <span class="sc">&lt;</span> <span class="dv">8</span> <span class="sc">~</span> <span class="fl">0.1</span>,</span>
<span id="cb29-5"><a href="nodes.html#cb29-5" aria-hidden="true" tabindex="-1"></a>    degree <span class="sc">&gt;=</span> <span class="dv">8</span> <span class="sc">&amp;</span> degree <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="fl">0.3</span>, </span>
<span id="cb29-6"><a href="nodes.html#cb29-6" aria-hidden="true" tabindex="-1"></a>    degree <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> degree <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="fl">0.5</span>,</span>
<span id="cb29-7"><a href="nodes.html#cb29-7" aria-hidden="true" tabindex="-1"></a>    degree <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">&amp;</span> degree <span class="sc">&lt;=</span> <span class="dv">154</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb29-8"><a href="nodes.html#cb29-8" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb29-9"><a href="nodes.html#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="nodes.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb29-11"><a href="nodes.html#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&#39;plot&#39;</span>)</span>
<span id="cb29-12"><a href="nodes.html#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(us_states) <span class="sc">+</span></span>
<span id="cb29-13"><a href="nodes.html#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb29-14"><a href="nodes.html#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(MafiaSpatial) <span class="sc">+</span></span>
<span id="cb29-15"><a href="nodes.html#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>(</span>
<span id="cb29-16"><a href="nodes.html#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span><span class="st">&quot;degree_brackets&quot;</span>, <span class="at">size.max =</span> <span class="dv">1</span>, <span class="at">scale =</span> <span class="fl">1.5</span>,</span>
<span id="cb29-17"><a href="nodes.html#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sizes.legend =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)<span class="sc">/</span><span class="dv">1</span><span class="sc">*</span><span class="fl">1.5</span>,</span>
<span id="cb29-18"><a href="nodes.html#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sizes.legend.labels =</span> <span class="fu">c</span>(<span class="st">&#39;2-8&#39;</span>,<span class="st">&#39;8-12&#39;</span>,<span class="st">&#39;12-20&#39;</span>,<span class="st">&#39;20-154&#39;</span>),</span>
<span id="cb29-19"><a href="nodes.html#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="st">&#39;lightblue&#39;</span>, <span class="at">border.col=</span><span class="st">&#39;#6698CC&#39;</span>, <span class="co">#blue grey</span></span>
<span id="cb29-20"><a href="nodes.html#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">border.alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb29-21"><a href="nodes.html#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title.size=</span><span class="fu">c</span>(<span class="st">&#39;Degree of Connections&#39;</span>))</span></code></pre></div>
<p><img src="SSN_tutorial_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<div id="visualize-nodes-by-size-and-color" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Visualize Nodes by Size and Color</h2>
<p>The automatic legend in tmap now cannot support color and size legend in one. <strong>To combine the color and size legend</strong>, we have to manually create a legend with the color and size attributes from the color and size legends, using <code>tm_add_legend</code>. To replicate the color, we use <code>RColorBrewer</code> package to generate colors for a given number, which is the default way that <code>tmap</code> assigns colors. To replicate the size, we pass in the square root of the actual node size. Setting node size in <code>tm_add_legend</code> is tricky, which is the square roots of the actual node size (see <a href="https://github.com/mtennekes/tmap/issues/451">here</a> for detail explanation). Remember: <strong>The final node size in the map = relative node size defined in <code>degree_brackets</code> / <code>size.max</code> * <code>scale</code></strong>. Lastly, we set the <code>legend.col.show =FALSE</code> and <code>legend.size.show =FALSE</code> to hide the default legends.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="nodes.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&#39;plot&#39;</span>)</span>
<span id="cb30-2"><a href="nodes.html#cb30-2" aria-hidden="true" tabindex="-1"></a>map <span class="ot">=</span> <span class="fu">tm_shape</span>(us_states) <span class="sc">+</span></span>
<span id="cb30-3"><a href="nodes.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="nodes.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(MafiaSpatial) <span class="sc">+</span></span>
<span id="cb30-5"><a href="nodes.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>(</span>
<span id="cb30-6"><a href="nodes.html#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#arguments that define point sizes </span></span>
<span id="cb30-7"><a href="nodes.html#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span><span class="st">&quot;degree_brackets&quot;</span>, <span class="at">size.max =</span> <span class="dv">1</span>, <span class="at">scale =</span> <span class="fl">1.5</span>,</span>
<span id="cb30-8"><a href="nodes.html#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.size.show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-9"><a href="nodes.html#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#arguments that define point colors </span></span>
<span id="cb30-10"><a href="nodes.html#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="st">&#39;degree_brackets&#39;</span>, <span class="at">palette =</span> <span class="st">&#39;YlGnBu&#39;</span>, <span class="at">n =</span> <span class="dv">4</span>,</span>
<span id="cb30-11"><a href="nodes.html#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span><span class="fl">0.5</span>, </span>
<span id="cb30-12"><a href="nodes.html#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">border.col=</span><span class="st">&#39;black&#39;</span>, <span class="at">border.alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb30-13"><a href="nodes.html#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.col.show =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb30-14"><a href="nodes.html#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_add_legend</span>(<span class="at">type=</span><span class="fu">c</span>(<span class="st">&quot;symbol&quot;</span>),</span>
<span id="cb30-15"><a href="nodes.html#cb30-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;#FFFFCC&quot;</span>, <span class="st">&quot;#A1DAB4&quot;</span>, <span class="st">&quot;#41B6C4&quot;</span>, <span class="st">&quot;#225EA8&quot;</span>), <span class="co">#copy from RColorBrewer: brewer.pal(4, &quot;YlGnBu&quot;)</span></span>
<span id="cb30-16"><a href="nodes.html#cb30-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">is.portrait =</span> <span class="cn">FALSE</span>, <span class="co"># legend becomes horizontal</span></span>
<span id="cb30-17"><a href="nodes.html#cb30-17" aria-hidden="true" tabindex="-1"></a>                <span class="co"># size defined here should be the square root of the normalized point size * scale. </span></span>
<span id="cb30-18"><a href="nodes.html#cb30-18" aria-hidden="true" tabindex="-1"></a>                <span class="co"># The square root is taken since the area is proportional to the data, not the radius.</span></span>
<span id="cb30-19"><a href="nodes.html#cb30-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> (<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="dv">1</span>)<span class="sc">/</span><span class="dv">1</span>)<span class="sc">^</span><span class="fl">0.5</span><span class="sc">*</span><span class="fl">1.5</span>, </span>
<span id="cb30-20"><a href="nodes.html#cb30-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;2-8&#39;</span>,<span class="st">&#39;8-12&#39;</span>,<span class="st">&#39;12-20&#39;</span>,<span class="st">&#39;20-154&#39;</span>), <span class="co">#break labels </span></span>
<span id="cb30-21"><a href="nodes.html#cb30-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">border.col =</span> <span class="st">&#39;black&#39;</span>, <span class="at">border.alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb30-22"><a href="nodes.html#cb30-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="fu">c</span>(<span class="st">&quot;Degree of Connections&quot;</span>))</span>
<span id="cb30-23"><a href="nodes.html#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="nodes.html#cb30-24" aria-hidden="true" tabindex="-1"></a>map</span></code></pre></div>
<p><img src="SSN_tutorial_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>To export the tmap object into a local folder, you can add:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="nodes.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(map, <span class="at">filename=</span><span class="st">&#39;YOUR_LOCAL_FOLDER_PATH/map.png&#39;</span>)</span></code></pre></div>
<p>The full codes for creating the map above is in the following:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="nodes.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb32-2"><a href="nodes.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb32-3"><a href="nodes.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb32-4"><a href="nodes.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb32-5"><a href="nodes.html#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb32-6"><a href="nodes.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb32-7"><a href="nodes.html#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SSNtools)</span>
<span id="cb32-8"><a href="nodes.html#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="nodes.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#read data</span></span>
<span id="cb32-10"><a href="nodes.html#cb32-10" aria-hidden="true" tabindex="-1"></a>MafiaSpatial <span class="ot">=</span> MafiaNodes <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="nodes.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">&quot;LonX&quot;</span>, <span class="st">&quot;LatY&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>) </span>
<span id="cb32-12"><a href="nodes.html#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="nodes.html#cb32-13" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">=</span> <span class="fu">states</span>(<span class="at">cb=</span><span class="cn">TRUE</span>, <span class="at">progress_bar=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="nodes.html#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>STUSPS <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;PR&#39;</span>,<span class="st">&#39;AS&#39;</span>, <span class="st">&#39;AK&#39;</span>, <span class="st">&#39;GU&#39;</span>,<span class="st">&#39;MP&#39;</span>,<span class="st">&#39;VI&#39;</span>, <span class="st">&#39;HI&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-15"><a href="nodes.html#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="st">&quot;ESRI:102010&quot;</span>)</span>
<span id="cb32-16"><a href="nodes.html#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="nodes.html#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a network and calculate the degree for each node.</span></span>
<span id="cb32-18"><a href="nodes.html#cb32-18" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">graph_from_data_frame</span>(MafiaEdges, <span class="at">directed =</span> <span class="cn">FALSE</span>, <span class="at">vertices=</span>MafiaSpatial)</span>
<span id="cb32-19"><a href="nodes.html#cb32-19" aria-hidden="true" tabindex="-1"></a>MafiaSpatial<span class="sc">$</span>degree <span class="ot">=</span> <span class="fu">degree</span>(g)</span>
<span id="cb32-20"><a href="nodes.html#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="nodes.html#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column that assign point size to points with varying degree.</span></span>
<span id="cb32-22"><a href="nodes.html#cb32-22" aria-hidden="true" tabindex="-1"></a>MafiaSpatial <span class="ot">=</span> MafiaSpatial <span class="sc">%&gt;%</span></span>
<span id="cb32-23"><a href="nodes.html#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">degree_brackets =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-24"><a href="nodes.html#cb32-24" aria-hidden="true" tabindex="-1"></a>    degree <span class="sc">&gt;=</span> <span class="fu">quantile</span>(MafiaSpatial<span class="sc">$</span>degree)[<span class="dv">1</span>] <span class="sc">&amp;</span> degree <span class="sc">&lt;</span> <span class="fu">quantile</span>(MafiaSpatial<span class="sc">$</span>degree)[<span class="dv">2</span>] <span class="sc">~</span> <span class="fl">0.1</span>,</span>
<span id="cb32-25"><a href="nodes.html#cb32-25" aria-hidden="true" tabindex="-1"></a>    degree <span class="sc">&gt;=</span> <span class="fu">quantile</span>(MafiaSpatial<span class="sc">$</span>degree)[<span class="dv">2</span>] <span class="sc">&amp;</span> degree <span class="sc">&lt;</span> <span class="fu">quantile</span>(MafiaSpatial<span class="sc">$</span>degree)[<span class="dv">3</span>] <span class="sc">~</span> <span class="fl">0.3</span>,</span>
<span id="cb32-26"><a href="nodes.html#cb32-26" aria-hidden="true" tabindex="-1"></a>    degree <span class="sc">&gt;=</span> <span class="fu">quantile</span>(MafiaSpatial<span class="sc">$</span>degree)[<span class="dv">3</span>] <span class="sc">&amp;</span> degree <span class="sc">&lt;</span> <span class="fu">quantile</span>(MafiaSpatial<span class="sc">$</span>degree)[<span class="dv">4</span>] <span class="sc">~</span> <span class="fl">0.5</span>,</span>
<span id="cb32-27"><a href="nodes.html#cb32-27" aria-hidden="true" tabindex="-1"></a>    degree <span class="sc">&gt;=</span> <span class="fu">quantile</span>(MafiaSpatial<span class="sc">$</span>degree)[<span class="dv">4</span>] <span class="sc">&amp;</span> degree <span class="sc">&lt;=</span> <span class="fu">quantile</span>(MafiaSpatial<span class="sc">$</span>degree)[<span class="dv">5</span>] <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb32-28"><a href="nodes.html#cb32-28" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb32-29"><a href="nodes.html#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="nodes.html#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb32-31"><a href="nodes.html#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&#39;plot&#39;</span>)</span>
<span id="cb32-32"><a href="nodes.html#cb32-32" aria-hidden="true" tabindex="-1"></a>map <span class="ot">=</span> <span class="fu">tm_shape</span>(us_states) <span class="sc">+</span></span>
<span id="cb32-33"><a href="nodes.html#cb32-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb32-34"><a href="nodes.html#cb32-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(MafiaSpatial) <span class="sc">+</span></span>
<span id="cb32-35"><a href="nodes.html#cb32-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>(</span>
<span id="cb32-36"><a href="nodes.html#cb32-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">#arguments that define point sizes</span></span>
<span id="cb32-37"><a href="nodes.html#cb32-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span><span class="st">&quot;degree_brackets&quot;</span>, <span class="at">size.max =</span> <span class="dv">1</span>, <span class="at">scale =</span> <span class="fl">1.5</span>,</span>
<span id="cb32-38"><a href="nodes.html#cb32-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.size.show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-39"><a href="nodes.html#cb32-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#arguments that define point colors</span></span>
<span id="cb32-40"><a href="nodes.html#cb32-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="st">&#39;degree&#39;</span>, <span class="at">palette =</span> <span class="st">&#39;YlGnBu&#39;</span>, <span class="at">style=</span><span class="st">&#39;quantile&#39;</span>, <span class="at">n =</span> <span class="dv">4</span>,</span>
<span id="cb32-41"><a href="nodes.html#cb32-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb32-42"><a href="nodes.html#cb32-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">border.col=</span><span class="st">&#39;black&#39;</span>, <span class="at">border.alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb32-43"><a href="nodes.html#cb32-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.col.show =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb32-44"><a href="nodes.html#cb32-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_add_legend</span>(<span class="at">type=</span><span class="fu">c</span>(<span class="st">&quot;symbol&quot;</span>),</span>
<span id="cb32-45"><a href="nodes.html#cb32-45" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="fu">brewer.pal</span>(<span class="dv">4</span>, <span class="st">&quot;YlGnBu&quot;</span>), <span class="co">#copy the color from R palette</span></span>
<span id="cb32-46"><a href="nodes.html#cb32-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">is.portrait =</span> <span class="cn">FALSE</span>, <span class="co"># legend becomes horizontal</span></span>
<span id="cb32-47"><a href="nodes.html#cb32-47" aria-hidden="true" tabindex="-1"></a>                <span class="co"># size defined here should be the sqaure root of the normalized point size * scale.</span></span>
<span id="cb32-48"><a href="nodes.html#cb32-48" aria-hidden="true" tabindex="-1"></a>                <span class="co"># The square root is taken since the area is proportional to the data, not the radius.</span></span>
<span id="cb32-49"><a href="nodes.html#cb32-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> (<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="dv">1</span>)<span class="sc">/</span><span class="dv">1</span>)<span class="sc">^</span><span class="fl">0.5</span><span class="sc">*</span><span class="fl">1.5</span>,</span>
<span id="cb32-50"><a href="nodes.html#cb32-50" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;2-8&#39;</span>,<span class="st">&#39;8-12&#39;</span>,<span class="st">&#39;12-20&#39;</span>,<span class="st">&#39;20-154&#39;</span>), <span class="co">#break labels</span></span>
<span id="cb32-51"><a href="nodes.html#cb32-51" aria-hidden="true" tabindex="-1"></a>                <span class="at">border.col =</span> <span class="st">&#39;black&#39;</span>, <span class="at">border.alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb32-52"><a href="nodes.html#cb32-52" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="fu">c</span>(<span class="st">&quot;Degree of Connections&quot;</span>))</span>
<span id="cb32-53"><a href="nodes.html#cb32-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-54"><a href="nodes.html#cb32-54" aria-hidden="true" tabindex="-1"></a><span class="co">#tmap_save(map, filename=&#39;YOUR_LOCAL_FOLDER_PATH/map.png&#39;)</span></span></code></pre></div>
<!-- ## Visualize Multiple Node Attributes -->
<!-- In the American Mafia example, we only visualize nodes with one attribute. What if we want to compare multiple attributes of a node? We use the remittance network data between countries as an example to show: -->
<!-- * Visualize multiple node attributes by size  -->
<!-- * Visualize multiple node attributes by size and color  -->
<!-- The remittance network data comes from [World Bank](https://www.worldbank.org/en/topic/migrationremittancesdiasporaissues/brief/migration-remittances-data) for the year 2017.   -->
<!-- ## Bounding Box and Inset Maps -->
<!-- ## Interactive mode and Base Maps  -->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="metrics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="vizedges.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SSN_tutorial.pdf", "SSN_tutorial.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
